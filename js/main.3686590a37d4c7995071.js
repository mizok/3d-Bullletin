(()=>{"use strict";var t,e={9735:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function r(t){try{c(o.next(t))}catch(t){a(t)}}function s(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((o=o.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Base=void 0;var a=n(6911),r=n(3200),s=n(774),c=n(691),u=n(5048),l=n(7918),h=!1,p=!1,d=function(){function t(t,e,n){this.canvas=t,this.domCanvas=e,this.domBundle=n,this.sizer=new s.Sizer(this.canvas),this.scene=new c.Scene,this.scene2=new c.Scene,this.ticker=new s.Ticker,this.camera=new r.Camera(this),this.renderer=new a.Renderer(this),this.playground=new l.Playground(this),this.touched=!1,this.touchedReactDelay=2e3,this.initResizeMechanic(),this.initTickMechanic(),this.initTouchMechanic()}return t.prototype.initResizeMechanic=function(){var t=this;this.sizer.on("resize",(function(){t.renderer.resize(),t.camera.resize()}))},t.prototype.initTickMechanic=function(){var t=this;this.ticker.on("tick",(function(e){var n=e.getDelta();t.renderer.update(),t.camera.update(),t.playground.update(n)}))},t.prototype.initTouchMechanic=function(){var t,e=this,n=new c.Vector2,o=new c.Vector2,i=function(t){n.x=t.clientX,n.y=t.clientY,e.touched=!0},a=function(i){o.x=i.clientX,o.y=i.clientY;var a=n.distanceTo(o)>5?e.touchedReactDelay:0;clearTimeout(t),t=setTimeout((function(){e.touched=!1}),a)};this.domCanvas.addEventListener("mousedown",i),this.domCanvas.addEventListener("touchstart",i),this.domCanvas.addEventListener("mouseup",a),this.domCanvas.addEventListener("touchend",a),this.domCanvas.addEventListener("mouseleave",a)},t.prototype.setRotationLock=function(t){h=t},t.prototype.getRotationLockStatus=function(){return h},t.prototype.setLoginStatus=function(t){p=t},t.prototype.getLoginStatus=function(){return p},t.prototype.getResources=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=this,[4,(0,u.getResources)()];case 1:return t.resources=e.sent(),[2]}}))}))},t}();e.Base=d},3200:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Camera=void 0;var o=n(691),i=n(2886),a=function(){function t(t){this.base=t,this.bestPoint=new o.Vector3(-8,1,5.6),this.minimunDrawbackAngle=Math.PI/3,this.sizer=this.base.sizer,this.canvas=this.base.domCanvas,this.scene=this.base.scene,this.setInstance(),this.setControls()}return t.prototype.setInstance=function(){var t=new o.PerspectiveCamera(35,this.sizer.width/this.sizer.height,.1,100);t.position.set(this.bestPoint.x,this.bestPoint.y,this.bestPoint.z),this.instance=t,this.scene.add(this.instance)},t.prototype.setControls=function(){this.controls=new i.OrbitControls(this.instance,this.canvas),this.controls.enableDamping=!0,this.controls.enableZoom=!1,this.controls.enablePan=!1},t.prototype.resize=function(){this.instance.aspect=this.sizer.width/this.sizer.height,this.instance.updateProjectionMatrix()},t.prototype.update=function(){this.controls.update()},t}();e.Camera=a},5590:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DomCube=void 0;var o=n(691),i=n(1648),a=n(9702),r=n(6358),s=n(5659),c=n(4799),u=n(475),l=function(){function t(t){this.base=t,this.groupOuter=new o.Group,this.groupInner=new o.Group,this.init()}return t.prototype.init=function(){var t,e;this.chat=new i.Chat(this.base),this.clock=new s.Clock(this.base),this.music=new u.Music(this.base),this.spaceInvader=new a.SpaceInvader(this.base),(t=this.groupInner.scale).set.apply(t,c.cubeLikeConfig.initialScale),(e=this.groupInner.rotation).set.apply(e,c.cubeLikeConfig.initialRotation),this.groupInner.add(this.chat.object),this.groupInner.add(this.clock.object),this.groupInner.add(this.music.object),this.groupInner.add(this.spaceInvader.object),this.groupOuter.add(this.groupInner),this.base.scene2.add(this.groupOuter),this.doAnimation()},t.prototype.doAnimation=function(){r.default.to(this.groupInner.rotation,c.cubeLikeConfig.startAnimationInnerRotationConfig),r.default.to(this.groupInner.scale,c.cubeLikeConfig.startAnimationInnerScalingConfig)},t.prototype.showChat=function(){r.default.to(this.groupInner.rotation,c.cubeLikeConfig.showChatAnimationInnerRotationConfig);var t=(0,c.getTargetAngle)(this.groupOuter.rotation.y);r.default.to(this.groupOuter.rotation,{x:0,y:t,z:0,duration:2})},t.prototype.update=function(t){this.base.touched||this.base.getRotationLockStatus()||(this.groupOuter.rotation.y+=t/c.cubeLikeConfig.updateParameter),this.chat.update(),this.clock.update(),this.music.update(),this.spaceInvader.update()},t}();e.DomCube=l},5755:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Env=void 0;var o=n(691),i=function(){function t(t){this.base=t,this.setLights()}return t.prototype.setLights=function(){this.setAmbientLight(),this.setDirectionalLight(),this.setBackground()},t.prototype.setDirectionalLight=function(){this.directionalLight=new o.DirectionalLight(16777215,1),this.directionalLight.castShadow=!0,this.directionalLight.shadow.mapSize.set(2048,2048),this.directionalLight.shadow.normalBias=.05,this.directionalLight.position.set(3.5,2,-1.25),this.base.scene.add(this.directionalLight)},t.prototype.setAmbientLight=function(){this.ambientLight=new o.AmbientLight(16777215,1),this.base.scene.add(this.ambientLight)},t.prototype.setBackground=function(){this.base.scene.background=this.base.resources.gradientCubeTexture},t.prototype.update=function(t){},t}();e.Env=i},7918:function(t,e,n){var o,i=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Playground=void 0;var a=n(5755),r=n(392),s=n(5590),c=function(t){function e(e){var n=t.call(this)||this;return n.base=e,n.ready=!1,n.init(),n}return i(e,t),e.prototype.init=function(){var t=this;this.base.getResources().then((function(){t.env=new a.Env(t.base),t.cube=new r.Cube(t.base),t.domCube=new s.DomCube(t.base),t.ready=!0,t.trigger("ready")}))},e.prototype.showChat=function(){this.cube.showChat(),this.domCube.showChat(),this.base.getLoginStatus()?this.domCube.chat.showScreen("guestList"):this.domCube.chat.showScreen("loginGuide")},e.prototype.update=function(t){this.ready&&(this.env.update(t),this.cube.update(t),this.domCube.update(t))},e}(n(774).EventEmitter);e.Playground=c},6911:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;var o=n(691),i=n(1564),a=function(){function t(t){this.base=t,this.sizer=this.base.sizer,this.canvas=this.base.canvas,this.domCanvas=this.base.domCanvas,this.scene=this.base.scene,this.scene2=this.base.scene2,this.camera=this.base.camera,this.setInstances()}return t.prototype.setInstances=function(){this.instance=new o.WebGLRenderer({canvas:this.canvas,antialias:!0}),this.instance.physicallyCorrectLights=!0,this.instance.toneMappingExposure=1.75,this.instance.shadowMap.enabled=!0,this.instance.shadowMap.type=o.PCFSoftShadowMap,this.instance.setClearColor(16777215),this.instance2=new i.CSS3DRenderer({element:this.domCanvas}),this.sizing()},t.prototype.resize=function(){this.sizing()},t.prototype.sizing=function(){this.instance.setSize(this.sizer.width,this.sizer.height),this.instance.setPixelRatio(this.sizer.pixelRatio),this.instance2.setSize(this.sizer.width,this.sizer.height)},t.prototype.update=function(){this.instance.render(this.scene,this.camera.instance),this.instance2.render(this.scene2,this.camera.instance)},t}();e.Renderer=a},17:function(t,e,n){var o,i=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Chat=void 0;var a=n(691),r=n(1564),s=n(774),c=n(4799),u=function(t){function e(e){var n=t.call(this)||this;return n.base=e,n.offset=1.7,n.pos=new a.Vector3(0,0,n.offset),n.normal=new a.Vector3(0,0,1),n.cNormal=new a.Vector3,n.cPos=new a.Vector3,n.m4=new a.Matrix4,n.setElement(),n}return i(e,t),e.prototype.setElement=function(){this.element=this.base.domBundle.querySelector("#chat-main-cube"),this.chatMainInner=this.element.querySelector("#chat-main-inner"),this.loginGuide=this.element.querySelector("#login-guide"),this.guestList=this.element.querySelector("#guest-list"),this.loginGuideBtn=this.element.querySelector("#login-guide-button"),this.object=new r.CSS3DObject(this.element),this.object.position.set(0,0,this.offset),this.object.scale.set(1/160,1/160,1),this.bindElementEvents()},e.prototype.showScreen=function(t){var e=this,n="chat-main__inner--hide";this[t].classList.remove(n),["chatMainInner","loginGuide","guestList"].filter((function(e){return e!==t})).forEach((function(t){var o;null===(o=e[t])||void 0===o||o.classList.add(n)}))},e.prototype.refreshGuestList=function(t){var e=this.guestList.querySelector("#guest-list-container");e.innerHTML="";var n="";t.forEach((function(t,e){var o='\n           <li class="guest-list__li guest" style="animation-delay:'.concat(200*e,'ms">\n                <div class="guest__name">').concat(t.username,"</div>\n            </li>\n            ");n+=o})),e.innerHTML=n},e.prototype.bindElementEvents=function(){var t=this;this.loginGuideBtn.addEventListener("pointerdown",(function(){t.trigger("cube-login-button-click")}))},e.prototype.setGuestNumber=function(t){this.guestList.querySelector("#guest-number").innerHTML="NOW ONLINE: ".concat(t)},e.prototype.update=function(){(0,c.updateOcclude)(this)},e}(s.EventEmitter);e.Chat=u},5659:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Clock=void 0;var o=n(691),i=n(1564),a=n(4799),r=function(){function t(t){this.base=t,this.offset=1.7,this.pos=new o.Vector3(-this.offset,0,0),this.normal=new o.Vector3(-1,0,0),this.cNormal=new o.Vector3,this.cPos=new o.Vector3,this.m4=new o.Matrix4,this.setElement()}return t.prototype.setElement=function(){this.element=this.base.domBundle.querySelector("#clock"),this.object=new i.CSS3DObject(this.element),this.object.position.set(-this.offset,0,0),this.object.rotation.y=-Math.PI/2,this.object.scale.set(1/160,1/160,1),this.initClock()},t.prototype.updateClock=function(){for(var t=new Date,e=t.getSeconds(),n=t.getMinutes(),o=t.getHours(),i=t.getMonth(),r=t.getDate(),s=t.getFullYear(),c=["mon","d","y","h","m","s"],u=[["January","February","March","April","May","June","July","August","September","October","November","December"][i],r,s,(0,a.pad)(o,2),(0,a.pad)(n,2),(0,a.pad)(e,2)],l=0;l<c.length;l++)this.element.querySelector("#".concat(c[l])).innerHTML=u[l].toString()},t.prototype.initClock=function(){this.updateClock(),this.timer=setInterval(this.updateClock.bind(this),1e3)},t.prototype.update=function(){(0,a.updateOcclude)(this)},t}();e.Clock=r},1648:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||o(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(17),e)},4799:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getTargetAngle=e.createElementFromHTML=e.cubeLikeConfig=e.pad=e.updateOcclude=void 0,e.updateOcclude=function(t){var e=t.base.playground.cube.mesh;t.cNormal.copy(t.normal).applyMatrix3(e.normalMatrix),t.cPos.copy(t.pos).applyMatrix4(t.m4.multiplyMatrices(t.base.camera.instance.matrixWorldInverse,e.matrixWorld));var n=t.cPos.negate().dot(t.cNormal);t.element.style.visibility=n<0?"hidden":"visible"},e.pad=function(t,e){for(var n=t.toString();n.length<e;n=0+n);return n},e.cubeLikeConfig={initialScale:[0,0,0],initialRotation:[Math.PI/3,-Math.PI/3,Math.PI/3],startAnimationInnerRotationConfig:{x:0,y:Math.PI/4,z:0,duration:2},startAnimationInnerScalingConfig:{x:1,y:1,z:1,duration:2},showChatAnimationInnerRotationConfig:{x:0,y:-Math.PI/4,z:0,duration:2},showChatAnimationOuterRotationConfig:{x:0,y:0,z:0,duration:2},updateParameter:5},e.createElementFromHTML=function(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild},e.getTargetAngle=function(t){var e=t%(2*Math.PI),n=t-e-.25*Math.PI,o=t+(7*Math.PI/4-e);return e<Math.PI?n:o}},7020:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.doAlert=e.doConfirm=void 0,e.doConfirm=function(t){var e,n=document.querySelector("#modal-confirm"),o=new Promise((function(t,n){e=t})),i=!1,a=function(t){switch(t.preventDefault(),t.target.getAttribute("option")){case"yes":i=!0,n.classList.remove("modal--active");break;case"no":i=!1,n.classList.remove("modal--active");break;case"close":n.classList.remove("modal--active")}t.currentTarget.removeEventListener("click",a),e(i)};return n.querySelector("p").innerHTML=t,n.classList.add("modal--active"),n.addEventListener("click",a),o},e.doAlert=function(t){var e=document.querySelector("#modal-alert"),n=function(t){t.preventDefault(),"close"===t.target.getAttribute("option")&&(t.currentTarget.removeEventListener("click",n),e.classList.remove("modal--active"))};e.querySelector("p").innerHTML=t,e.classList.add("modal--active"),e.addEventListener("click",n)}},475:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Music=void 0;var o=n(691),i=n(1564),a=n(4799),r=function(){function t(t){this.base=t,this.offset=1.7,this.pos=new o.Vector3(this.offset,0,0),this.normal=new o.Vector3(1,0,0),this.cNormal=new o.Vector3,this.cPos=new o.Vector3,this.m4=new o.Matrix4,this.setElement()}return t.prototype.setElement=function(){this.element=this.base.domBundle.querySelector("#music"),this.object=new i.CSS3DObject(this.element),this.object.position.set(this.offset,0,0),this.object.rotation.y=Math.PI/2,this.object.scale.set(1/160,1/160,1)},t.prototype.update=function(){(0,a.updateOcclude)(this)},t}();e.Music=r},9702:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SpaceInvader=void 0;var o=n(691),i=n(1564),a=n(4799),r=function(){function t(t){this.base=t,this.offset=1.7,this.pos=new o.Vector3(0,0,-this.offset),this.normal=new o.Vector3(0,0,-1),this.cNormal=new o.Vector3,this.cPos=new o.Vector3,this.m4=new o.Matrix4,this.setElement()}return t.prototype.setElement=function(){this.element=this.base.domBundle.querySelector("#space-invader"),this.object=new i.CSS3DObject(this.element),this.object.position.set(0,0,-this.offset),this.object.rotation.y=-Math.PI,this.object.scale.set(1/160,1/160,1)},t.prototype.update=function(){(0,a.updateOcclude)(this)},t}();e.SpaceInvader=r},2367:function(t,e,n){var o,i=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,a){function r(t){try{c(o.next(t))}catch(t){a(t)}}function s(t){try{c(o.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}c((o=o.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,o,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s,c,u,l=n(9735),h=n(3859),p=n(6486),d=n(4799),f=n(7020),m=function(t){function e(e,n,o){var i=t.call(this,e,n,o)||this;return i.wrapper=document.querySelector("#wrapper"),i.chatBlock=document.querySelector("#chat-block"),i.rotationLock=i.chatBlock.querySelector("#rotation-lock"),i.chatBlockActive=!1,i.path="https://3d-cube-chat.fly.dev",i.initChatUI(),i}return i(e,t),e.prototype.toggleRotationLockFromUI=function(){var t=this.getRotationLockStatus();t?this.rotationLock.classList.remove("chat-block__rotation-lock--active"):this.rotationLock.classList.add("chat-block__rotation-lock--active"),this.setRotationLock(!t)},e.prototype.setRotationLockFromUI=function(t){t?this.rotationLock.classList.add("chat-block__rotation-lock--active"):this.rotationLock.classList.remove("chat-block__rotation-lock--active"),this.setRotationLock(t)},e.prototype.initChatUI=function(){var t=this,e=this.chatBlock.querySelector("#chat-block-toggler"),n=this.chatBlock.querySelector("#login-button"),o=this.chatBlock.querySelector("#send-message-button"),i=this.chatBlock.querySelector("#logout-button");e.addEventListener("click",(function(){var e;t.chatBlockActive?(t.wrapper.classList.remove("wrapper--active"),e=t.getLoginStatus()?"chatMainInner":"loginGuide",t.setRotationLockFromUI(!1)):(t.wrapper.classList.add("wrapper--active"),e=t.getLoginStatus()?"guestList":"loginGuide",t.setRotationLockFromUI(!0),t.playground.showChat()),t.playground.domCube.chat.showScreen(e),t.chatBlockActive=!t.chatBlockActive})),this.playground.on("ready",(function(){t.playground.domCube.chat.showScreen("loginGuide"),t.playground.domCube.chat.on("cube-login-button-click",(function(){var e,n;t.setRotationLockFromUI(!0),1==(e=!0)?(t.wrapper.classList.add("wrapper--active"),n=t.getLoginStatus()?"guestList":"loginGuide",t.getLoginStatus()&&t.setRotationLockFromUI(!0),t.playground.showChat()):(t.wrapper.classList.remove("wrapper--active"),n=t.getLoginStatus()?"chatMainInner":"loginGuide",t.setRotationLockFromUI(!1)),t.playground.domCube.chat.showScreen(n),t.chatBlockActive=e}))})),this.rotationLock.addEventListener("click",this.toggleRotationLockFromUI.bind(this)),n.addEventListener("click",(function(){t.myName=(0,p.trim)(t.chatBlock.querySelector("#login-name").value),t.myName?(t.socket=(0,h.io)(t.path),t.initChatSocket(),t.socket.emit("login",{username:t.myName})):(0,f.doAlert)("Please enter a name :)")})),o.addEventListener("click",(function(){t.sendMessage()})),i.addEventListener("click",(function(){return a(t,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,(0,f.doConfirm)("Are you sure you want to leave the chat?")];case 1:return t.sent()&&this.socket.emit("logout",{username:this.myName}),[2]}}))}))})),document.addEventListener("keydown",(function(e){13==e.keyCode&&t.sendMessage()}))},e.prototype.initChatSocket=function(){var t=this;this.socket.on("loginSuccess",(function(e){e.username===t.myName?t.checkIn(e):(0,f.doAlert)("Wrong username:( Please try again!")})),this.socket.on("loginFail",(function(){(0,f.doAlert)("Duplicate name already exists :(")})),this.socket.on("add",(function(e){"<p>".concat(e.username," 加入聊天室</p>");t.playground.domCube.chat.setGuestNumber(e.userCount),t.playground.domCube.chat.refreshGuestList(null==e?void 0:e.users)})),this.socket.on("leaveSuccess",(function(){t.checkOut()})),this.socket.on("leave",(function(e){if(null!=e.username){t.playground.domCube.chat.refreshGuestList(null==e?void 0:e.users);"<p>".concat(e.username," 退出聊天室</p>");t.playground.domCube.chat.setGuestNumber(e.userCount)}})),this.socket.on("receiveMessage",(function(e){t.showMessage(e)}))},e.prototype.checkIn=function(t){var e=this.chatBlock.querySelector("#login");this.chatBlock.querySelector("#my-name").innerHTML=t.username,e.classList.add("login--logined"),this.setRotationLockFromUI(!0),this.setLoginStatus(!0),this.playground.showChat()},e.prototype.checkOut=function(){this.chatBlock.querySelector("#login").classList.remove("login--logined"),this.playground.domCube.chat.showScreen("loginGuide"),this.chatBlock.querySelector("#chat-main").innerHTML="",this.setLoginStatus(!1)},e.prototype.sendMessage=function(){var t=this.chatBlock.querySelector("#message-input"),e=t.value;t.value="",e&&this.socket.emit("sendMessage",{username:this.myName,message:e})},e.prototype.showMessage=function(t){var e;e=t.username===this.myName?'<div class="chat-main__chat ">\n                        <div class="chat-main__bubble-name">You</div>\n                        <div class="chat-main__bubble">'.concat(t.message,"</div>\n                    </div>\n                    "):'<div class="chat-main__chat chat-main__chat--other">\n                        <div class="chat-main__bubble-name">'.concat(t.username,'</div>\n                        <div class="chat-main__bubble">').concat(t.message,"</div>\n                    </div>\n                    ");var n=(0,d.createElementFromHTML)(e),o=this.chatBlock.querySelector("#chat-main"),i=this.wrapper.querySelector("#chat-main-cube .chat-main__inner#chat-main-inner");o.appendChild(n),i.appendChild(n.cloneNode(!0)),o.parentElement.scrollTop=o.scrollHeight,i.scrollTop=i.scrollHeight},e}(l.Base);s=document.querySelector("#canvas"),c=document.querySelector("#dom-canvas"),u=document.querySelector("#dom-bundle"),new m(s,c,u)},6076:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cube=void 0;var o=n(6358),i=n(691),a=n(4799),r=function(){function t(t){this.base=t,this.setModel()}return t.prototype.createRoundedBoxGeo=function(t,e,n,o,a){var r=new i.Shape,s=1e-5,c=o-s,u=.25;r.absarc(s,s,u,-Math.PI/2,-Math.PI,!0),r.absarc(s,e-2*c,u,Math.PI,Math.PI/2,!0),r.absarc(t-2*c,e-2*c,u,Math.PI/2,0,!0),r.absarc(t-2*c,s,u,0,-Math.PI/2,!0);var l=new i.ExtrudeGeometry(r,{depth:n-o,bevelEnabled:!0,bevelSegments:2*a,steps:1,bevelSize:c,bevelThickness:o,curveSegments:a});return l.center(),l},t.prototype.setModel=function(){var t,e,n=this.createRoundedBoxGeo(3,3,3,.4,20),o=new i.MeshMatcapMaterial({matcap:this.base.resources.cubeMatcap});this.group=new i.Group,this.mesh=new i.Mesh(n,o),(t=this.mesh.scale).set.apply(t,a.cubeLikeConfig.initialScale),(e=this.mesh.rotation).set.apply(e,a.cubeLikeConfig.initialRotation),this.group.add(this.mesh),this.base.scene.add(this.group),this.doAnimation()},t.prototype.doAnimation=function(){o.default.to(this.mesh.rotation,a.cubeLikeConfig.startAnimationInnerRotationConfig),o.default.to(this.mesh.scale,a.cubeLikeConfig.startAnimationInnerScalingConfig)},t.prototype.showChat=function(){o.default.to(this.mesh.rotation,a.cubeLikeConfig.showChatAnimationInnerRotationConfig);var t=(0,a.getTargetAngle)(this.group.rotation.y);o.default.to(this.group.rotation,{x:0,y:t,z:0,duration:2}),o.default.to(this.base.camera.instance.position,{x:this.base.camera.bestPoint.x,y:this.base.camera.bestPoint.y,z:this.base.camera.bestPoint.z,duration:4})},t.prototype.update=function(t){this.base.touched||this.base.getRotationLockStatus()||(this.group.rotation.y+=t/a.cubeLikeConfig.updateParameter)},t}();e.Cube=r},392:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||o(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(6076),e)},5048:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getResources=void 0;var o=n(8394),i=n(691),a=new i.TextureLoader,r=new i.CubeTextureLoader,s=function(t){return new Promise((function(e,n){a.load(t.path,(function(n){e({name:t.name,content:n})}),null,n)}))},c=function(t){return new Promise((function(e,n){r.load(t.paths,(function(n){e({name:t.name,content:n})}),null,(function(t){console.log(t)}))}))};e.getResources=function(){for(var t=[],e=0,n=o.textureSources;e<n.length;e++){var i=n[e];switch(i.type){case"cubeTexture":t.push(c(i));break;case"texture":t.push(s(i))}}return Promise.all(t).then((function(t){var e={};return t.forEach((function(t){e[t.name]=t.content})),e}))}},8394:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.textureSources=void 0,e.textureSources=[{name:"gradientCubeTexture",type:"cubeTexture",paths:["./assets/images/cubemap/gs-gradient/px.png","./assets/images/cubemap/gs-gradient/nx.png","./assets/images/cubemap/gs-gradient/py.png","./assets/images/cubemap/gs-gradient/ny.png","./assets/images/cubemap/gs-gradient/pz.png","./assets/images/cubemap/gs-gradient/nz.png"]},{name:"cubeMatcap",type:"texture",path:"./assets/images/matcap/BlackRough.png"}]},3111:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var n=function(){function t(){this.callbacks={},this.callbacks={},this.callbacks.base={}}return t.prototype.on=function(t,e){var n=this;return void 0===t||""===t?(console.warn("wrong names"),!1):void 0===e?(console.warn("wrong callback"),!1):(this.resolveNames(t).forEach((function(t){var o=n.resolveName(t);n.callbacks[o.namespace]instanceof Object||(n.callbacks[o.namespace]={}),n.callbacks[o.namespace][o.value]instanceof Array||(n.callbacks[o.namespace][o.value]=[]),n.callbacks[o.namespace][o.value].push(e)})),this)},t.prototype.off=function(t){var e=this;return void 0===t||""===t?(console.warn("wrong name"),!1):(this.resolveNames(t).forEach((function(t){var n=e.resolveName(t);if("base"!==n.namespace&&""===n.value)delete e.callbacks[n.namespace];else if("base"===n.namespace)for(var o in e.callbacks)e.callbacks[o]instanceof Object&&e.callbacks[o][n.value]instanceof Array&&(delete e.callbacks[o][n.value],0===Object.keys(e.callbacks[o]).length&&delete e.callbacks[o]);else e.callbacks[n.namespace]instanceof Object&&e.callbacks[n.namespace][n.value]instanceof Array&&(delete e.callbacks[n.namespace][n.value],0===Object.keys(e.callbacks[n.namespace]).length&&delete e.callbacks[n.namespace])})),this)},t.prototype.trigger=function(t,e){var n=this;if(void 0===t||""===t)return console.warn("wrong name"),!1;var o=null,i=null,a=e instanceof Array?e:[],r=this.resolveNames(t),s=this.resolveName(r[0]);if("base"===s.namespace)for(var c in this.callbacks)this.callbacks[c]instanceof Object&&this.callbacks[c][s.value]instanceof Array&&this.callbacks[c][s.value].forEach((function(t){i=t.apply(n,a),void 0===o&&(o=i)}));else if(this.callbacks[s.namespace]instanceof Object){if(""===s.value)return console.warn("wrong name"),this;this.callbacks[s.namespace][s.value].forEach((function(t){i=t.apply(n,a),void 0===o&&(o=i)}))}return o},t.prototype.resolveNames=function(t){var e=t;return e=(e=(e=e.replace(/[^a-zA-Z0-9 ,/.]/g,"")).replace(/[,/]+/g," ")).split(" ")},t.prototype.resolveName=function(t){var e={},n=t.split(".");return e.original=t,e.value=n[0],e.namespace="base",n.length>1&&""!==n[1]&&(e.namespace=n[1]),e},t}();e.EventEmitter=n},774:function(t,e,n){var o=this&&this.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n),Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||o(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(3111),e),i(n(1600),e),i(n(5388),e)},5388:function(t,e,n){var o,i=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Sizer=void 0;var a=function(t){function e(e){var n=t.call(this)||this;return n.canvas=e,n.pixelRatio=Math.min(window.devicePixelRatio,2),n.initSizingMechanic(),n}return i(e,t),e.prototype.initSizingMechanic=function(){this.sizing(),window.addEventListener("resize",this.sizing.bind(this))},e.prototype.sizing=function(){var t=this.canvas.parentElement.getBoundingClientRect();this.width=t.width,this.height=t.height,this.trigger("resize",[this.width,this.height])},e}(n(3111).EventEmitter);e.Sizer=a},1600:function(t,e,n){var o,i=this&&this.__extends||(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Ticker=void 0;var a=n(3111),r=n(691),s=function(t){function e(){var e=t.call(this)||this;return e.clock=new r.Clock,window.requestAnimationFrame((function(){e.tick()})),e}return i(e,t),e.prototype.tick=function(){var t=this;this.trigger("tick",[this.clock]),window.requestAnimationFrame((function(){t.tick()}))},e}(a.EventEmitter);e.Ticker=s},1163:()=>{},142:()=>{}},n={};function o(t){var i=n[t];if(void 0!==i)return i.exports;var a=n[t]={id:t,loaded:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.loaded=!0,a.exports}o.m=e,t=[],o.O=(e,n,i,a)=>{if(!n){var r=1/0;for(u=0;u<t.length;u++){for(var[n,i,a]=t[u],s=!0,c=0;c<n.length;c++)(!1&a||r>=a)&&Object.keys(o.O).every((t=>o.O[t](n[c])))?n.splice(c--,1):(s=!1,a<r&&(r=a));s&&(t.splice(u--,1),e=i())}return e}a=a||0;for(var u=t.length;u>0&&t[u-1][2]>a;u--)t[u]=t[u-1];t[u]=[n,i,a]},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={179:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var i,a,[r,s,c]=n,u=0;for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(c)var l=c(o);for(e&&e(n);u<r.length;u++)a=r[u],o.o(t,a)&&t[a]&&t[a][0](),t[r[u]]=0;return o.O(l)},n=self.webpackChunkwebpack_playground=self.webpackChunkwebpack_playground||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),o.O(void 0,[736],(()=>o(7310))),o.O(void 0,[736],(()=>o(2367))),o.O(void 0,[736],(()=>o(142)));var i=o.O(void 0,[736],(()=>o(1163)));i=o.O(i)})();
//# sourceMappingURL=main.3686590a37d4c7995071.js.map